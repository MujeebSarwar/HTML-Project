(()=>{"use strict";var t=Object.defineProperty,e=Object.defineProperties,r=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,s=(e,r,o)=>r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[r]=o,a=(t,e)=>{for(var r in e||(e={}))n.call(e,r)&&s(t,r,e[r]);if(o)for(var r of o(e))i.call(e,r)&&s(t,r,e[r]);return t},u=(t,o)=>e(t,r(o));const l=t=>{localStorage.setItem("nosto_ugc_tile_interactions",JSON.stringify(t))},c=t=>{window.location.href.indexOf("gaDebug=1")>-1&&console.log(t)},g=()=>{const t=localStorage.getItem("nosto_ugc_tile_interactions");return t||"[]"};var d=Object.defineProperty,_=Object.defineProperties,v=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,C=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,m=(t,e,r)=>e in t?d(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,y=(t,e)=>{for(var r in e||(e={}))C.call(e,r)&&m(t,r,e[r]);if(p)for(var r of p(e))f.call(e,r)&&m(t,r,e[r]);return t},w=(t,e)=>_(t,v(e));const U={get:t=>U.create(t),create:(t={})=>{var e,r;const o=w(y({},t),{id:t.id?t.id:null,terms:t.terms?t.terms.map((t=>t?parseInt(t.toString()):0)):[],tags:t.tags?t.tags.map((t=>t?parseInt(t.toString()):0)):[],productTags:t.productTags?t.productTags.map((t=>t?parseInt(t.toString()):0)):[],widgetId:t.widgetId?parseInt(t.widgetId.toString()):0,nostoUGCConversion:null!=(e=t.nostoUGCConversion)&&e,nostoUGCConversionExpiry:null!=(r=t.nostoUGCConversionExpiry)?r:(new Date).getTime()-1}),n={getTile:()=>o,hasTile:()=>!!o.id,getTags:()=>o.tags,getTerms:()=>o.terms,getProductTags:()=>o.productTags,getWidgetId:()=>o.widgetId,isUGCConversion:()=>{var t;return null!=(t=o.nostoUGCConversion)&&t},isUGCConversionExpired:()=>{var t;return(null!=(t=o.nostoUGCConversionExpiry)?t:0)<(new Date).getTime()},getConversionExpiry:()=>{var t;return null!=(t=o.nostoUGCConversionExpiry)?t:0},setUGCConversion:t=>(c(`Setting UGC Conversion to ${t} - before`),c(o.toString()),o.nostoUGCConversion=t,U.get(o)),setUGCConversionExpiry:t=>t?(o.nostoUGCConversionExpiry=t,U.get(o)):(o.nostoUGCConversionExpiry=(new Date).getTime()+864e5,U.get(o)),getJSON:(t=[])=>{const e=Object.keys(o).reduce(((t,e)=>(t[e]=o[e],t)),{});if(0===t.length)return JSON.stringify(e);const r=t.reduce(((t,e)=>w(y({},t),{[e]:o[e]})),{});return JSON.stringify(r)},save:()=>{const t=g();let e=t?JSON.parse(t):[];Array.isArray(e)||(e=[e]);const r=e.filter(((t,r)=>{if(t.id===o.id)return e[r]=o,!0}));return l(e),0==r.length&&(e.push(o),l(e)),n}};return n},createFromJSONString:t=>{let e=[];return t&&(e=JSON.parse(t)),Array.isArray(e)||(e=[e]),{get:()=>e.map((t=>U.get(t))),first:()=>{const t=e[0];return U.get(t)}}},getAllFromStorage:()=>{const t=g();return t?U.createFromJSONString(t).get():[]}},S=U,h={getProductByProductId:t=>{const e=S.getAllFromStorage().find((e=>e.getProductTags().includes(parseInt(t))));return e||null},shopperHasConversion:()=>S.getAllFromStorage().filter((t=>{const e=t.isUGCConversion(),r=t.isUGCConversionExpired();return e&&!r})).length>0,getProductsWithConversions:()=>S.getAllFromStorage().filter((t=>t.isUGCConversion())),resetUserConversions:(t=!1)=>{S.getAllFromStorage().forEach((e=>{t&&!e.hasTile()||(e.setUGCConversion(!1),e.save())}))},syncWithCart(t){const e=this.getProductByProductId(t);e&&(e.setUGCConversion(!0),e.setUGCConversionExpiry(),e.save())},createGoogleUserProperties:t=>{if(!t||!Array.isArray(t))return;const e=t.map((t=>(t=>{var e,r,o,n,i,s,l,c,g,d;let _={nosto_ugc_widget:void 0!==t.widgetId?t.widgetId:0,nosto_ugc_filter:void 0!==t.filterId?t.filterId:0};if(t.locationId&&(_=u(a({},_),{nosto_ugc_location_id:t.locationId,nosto_ugc_location_name:t.locationName})),t.shareNetwork&&(_=u(a({},_),{nosto_ugc_shared_network:t.shareNetwork?t.shareNetwork:"N/A"})),t.id||t.tileData){const v=(t=>{var e;if(!t.tileData&&!t.terms)return[];const r=void 0!==(t.tileData&&t.tileData.term_meta)?null==(e=t.tileData)?void 0:e.term_meta:t.terms;return r?r.map((t=>{var e;return null!=(e=t.term_id)?e:t})).filter((t=>null!==t)):[]})(t),p=(t=>{var e,r;if(!t.tileData&&!t.tags)return[];const o=null!=(r=t.tags)?r:null==(e=t.tileData)?void 0:e.tags;return o?o.map((t=>t.id?t.id:t)).filter((t=>null!==t)):[]})(t);_=a({},_),(t.id||t.tileData)&&(_=u(a({},_),{nosto_ugc_tile_id:null!=(r=t.id)?r:null==(e=t.tileData)?void 0:e._id.$id})),(t.source||t.tileData)&&(_=u(a({},_),{nosto_ugc_source:null!=(n=t.source)?n:null==(o=t.tileData)?void 0:o.source})),(t.media||t.tileData)&&(_=u(a({},_),{nosto_ugc_media:null!=(s=t.media)?s:null==(i=t.tileData)?void 0:i.media})),(t.user||t.tileData)&&(_=u(a({},_),{nosto_ugc_user:null!=(c=t.user)?c:null==(l=t.tileData)?void 0:l.user})),(t.url||t.tileData)&&(_=u(a({},_),{nosto_ugc_url:null!=(d=t.url)?d:null==(g=t.tileData)?void 0:g.original_url})),v.length>0&&(_=u(a({},_),{nosto_ugc_terms:v.join(",")})),p.length>0&&(_=u(a({},_),{nosto_ugc_tags:p.join(",")}))}return _})(t.getTile()))),r={nosto_ugc_tags:"nosto_ugc_tags_user",nosto_ugc_terms:"nosto_ugc_terms_user",nosto_ugc_media:"nosto_ugc_media_user",nosto_ugc_widget:"nosto_ugc_widget_user",nosto_ugc_tile_id:"nosto_ugc_tile_id_user"},o=e.reduce(((t,e)=>(Object.keys(e).forEach((o=>{var n;const i=null!=(n=r[o])?n:o;t[i]&&t[i]!==e[o]?t[i]=`${t[i]},${e[o]}`:void 0!==e[o]&&(t[i]=e[o])})),t)),{});return o.is_nosto_ugc_user="true",o}};function G(...t){window.dataLayer.push(t)}function O(){if(E()){const t=D();if(t){const e=h.getProductByProductId(t);if(e)return h.createGoogleUserProperties([e])}}return h.createGoogleUserProperties(S.getAllFromStorage())}function P(){const t=O();return t&&G("set","user_properties",t),O()}function I(){const t=function(){const t=localStorage.getItem("nosto_ugc_user_id");return t||!1}();return t&&G("set","user_id",t),t}function b(t=!1,e=0){return function(){const t=document.querySelectorAll(".nosto_cart .line_item");t&&t.length>0&&(h.resetUserConversions(!0),t.forEach((t=>{var e;const r=null==(e=null==t?void 0:t.querySelector(".product_id"))?void 0:e.innerHTML;r&&h.syncWithCart(r)})))}(),I(),h.shopperHasConversion()&&P(),E()&&(!function(){const t=D();if(!t)return!1;const e=h.getProductByProductId(t);!!e&&e.setUGCConversion(!0).setUGCConversionExpiry().save()}(),P(),t&&1==e&&G("event","nosto_ugc_view_item")),t||(setTimeout((()=>{b(!0,1)}),1e3),setInterval((()=>{b(!0)}),18e4)),!1}function D(){const t=document.querySelector(".nosto_product .product_id");return!!t&&t.innerText}function E(){var t;const e=D();if(!e)return!1;const r=h.getProductByProductId(e);if(r)return r.setUGCConversion(!0),r.setUGCConversionExpiry(),r.save(),!0;const o=null!=(t=h.getProductsWithConversions())?t:[];return h.getProductByProductId(e)||o.length>0}try{new function(){window.dataLayer=window.dataLayer||[],b()}}catch(t){console.log("Failed to intitialise UGC client script",t)}})();